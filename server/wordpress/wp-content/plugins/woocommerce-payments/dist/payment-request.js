!function(){"use strict";jQuery((function(t){var e,a=Stripe(wcpayPaymentRequestParams.stripe.publishableKey,{stripeAccount:wcpayPaymentRequestParams.stripe.accountId}),n={getAjaxURL:function(t){return wcpayPaymentRequestParams.ajax_url.toString().replace("%%endpoint%%","wcpay_"+t)},getCartDetails:function(){var e={security:wcpayPaymentRequestParams.nonce.payment};t.ajax({type:"POST",data:e,url:n.getAjaxURL("get_cart_details"),success:function(t){n.startPaymentRequest(t)}})},getAttributes:function(){var e=t(".variations_form").find(".variations select"),a={},n=0,s=0;return e.each((function(){var e=t(this).data("attribute_name")||t(this).attr("name"),o=t(this).val()||"";0<o.length&&s++,n++,a[e]=o})),{count:n,chosenCount:s,data:a}},processPaymentMethod:function(e){var a=n.getOrderData(e);return t.ajax({type:"POST",data:a,dataType:"json",url:n.getAjaxURL("create_order")})},getOrderData:function(t){var a=t.paymentMethod,n=a.billing_details.email,s=a.billing_details.phone,o=a.billing_details.address,i=a.billing_details.name,r=t.shippingAddress,u={_wpnonce:wcpayPaymentRequestParams.nonce.checkout,billing_first_name:null!==i?i.split(" ").slice(0,1).join(" "):"",billing_last_name:null!==i?i.split(" ").slice(1).join(" "):"",billing_company:"",billing_email:null!==n?n:t.payerEmail,billing_phone:null!==s?s:t.payerPhone.replace("/[() -]/g",""),billing_country:null!==o?o.country:"",billing_address_1:null!==o?o.line1:"",billing_address_2:null!==o?o.line2:"",billing_city:null!==o?o.city:"",billing_state:null!==o?o.state:"",billing_postcode:null!==o?o.postal_code:"",shipping_first_name:"",shipping_last_name:"",shipping_company:"",shipping_country:"",shipping_address_1:"",shipping_address_2:"",shipping_city:"",shipping_state:"",shipping_postcode:"",shipping_method:[null===t.shippingOption?null:t.shippingOption.id],order_comments:"",payment_method:"woocommerce_payments",ship_to_different_address:1,terms:1,"wcpay-payment-method":a.id,payment_request_type:e};return r&&(u.shipping_first_name=r.recipient.split(" ").slice(0,1).join(" "),u.shipping_last_name=r.recipient.split(" ").slice(1).join(" "),u.shipping_company=r.organization,u.shipping_country=r.country,u.shipping_address_1=void 0===r.addressLine[0]?"":r.addressLine[0],u.shipping_address_2=void 0===r.addressLine[1]?"":r.addressLine[1],u.shipping_city=r.city,u.shipping_state=r.region,u.shipping_postcode=r.postalCode),u},getErrorMessageHTML:function(e){return t('<div class="woocommerce-error" />').text(e)},abortPayment:function(e,a){e.complete("fail"),t(".woocommerce-error").remove();var n=t(".woocommerce-notices-wrapper").first();n.length&&(n.append(a),t("html, body").animate({scrollTop:n.find(".woocommerce-error").offset().top},600))},completePayment:function(t,e){n.block(),t.complete("success"),window.location=e},block:function(){t.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateShippingOptions:function(a,s){var o={security:wcpayPaymentRequestParams.nonce.shipping,country:s.country,state:s.region,postcode:s.postalCode,city:s.city,address:void 0===s.addressLine[0]?"":s.addressLine[0],address_2:void 0===s.addressLine[1]?"":s.addressLine[1],payment_request_type:e,is_product_page:wcpayPaymentRequestParams.is_product_page};return t.ajax({type:"POST",data:o,url:n.getAjaxURL("get_shipping_options")})},updateShippingDetails:function(a,s){var o={security:wcpayPaymentRequestParams.nonce.update_shipping,shipping_method:[s.id],payment_request_type:e,is_product_page:wcpayPaymentRequestParams.is_product_page};return t.ajax({type:"POST",data:o,url:n.getAjaxURL("update_shipping_method")})},addToCart:function(){var e=t(".single_add_to_cart_button").val();t(".single_variation_wrap").length&&(e=t(".single_variation_wrap").find('input[name="product_id"]').val());var a={security:wcpayPaymentRequestParams.nonce.add_to_cart,product_id:e,qty:t(".quantity .qty").val(),attributes:t(".variations_form").length?n.getAttributes().data:[]},s=t("form.cart").serializeArray();return t.each(s,(function(t,e){if(/^addon-/.test(e.name))if(/\[\]$/.test(e.name)){var n=e.name.substring(0,e.name.length-2);a[n]?a[n].push(e.value):a[n]=[e.value]}else a[e.name]=e.value})),t.ajax({type:"POST",data:a,url:n.getAjaxURL("add_to_cart")})},clearCart:function(){var e={security:wcpayPaymentRequestParams.nonce.clear_cart};return t.ajax({type:"POST",data:e,url:n.getAjaxURL("clear_cart"),success:function(){}})},getRequestOptionsFromLocal:function(){return{total:wcpayPaymentRequestParams.product.total,currency:wcpayPaymentRequestParams.checkout.currency_code,country:wcpayPaymentRequestParams.checkout.country_code,requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:wcpayPaymentRequestParams.checkout.needs_payer_phone,requestShipping:wcpayPaymentRequestParams.product.requestShipping,displayItems:wcpayPaymentRequestParams.product.displayItems}},startPaymentRequest:function(s){var o,i;wcpayPaymentRequestParams.is_product_page?(i=n.getRequestOptionsFromLocal(),o=i):(i={total:s.order_data.total,currency:s.order_data.currency,country:s.order_data.country_code,requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:wcpayPaymentRequestParams.checkout.needs_payer_phone,requestShipping:!!s.shipping_required,displayItems:s.order_data.displayItems},o=s.order_data),"PR"===i.country&&(i.country="US");var r=a.paymentRequest(i),u=a.elements({locale:wcpayPaymentRequestParams.button.locale}),c=n.createPaymentRequestButton(u,r);r.canMakePayment().then((function(t){t&&(e=t.applePay?"apple_pay":"payment_request_api",n.attachPaymentRequestButtonEventListeners(c,r),n.showPaymentRequestButton(c))})),r.on("shippingaddresschange",(function(e){t.when(n.updateShippingOptions(o,e.shippingAddress)).then((function(t){e.updateWith({status:t.result,shippingOptions:t.shipping_options,total:t.total,displayItems:t.displayItems})}))})),r.on("shippingoptionchange",(function(e){t.when(n.updateShippingDetails(o,e.shippingOption)).then((function(t){"success"===t.result&&e.updateWith({status:"success",total:t.total,displayItems:t.displayItems}),"fail"===t.result&&e.updateWith({status:"fail"})}))})),r.on("paymentmethod",(function(e){"no"===wcpayPaymentRequestParams.stripe.allow_prepaid_card&&"prepaid"===e.source.card.funding?n.abortPayment(e,n.getErrorMessageHTML(wcpayPaymentRequestParams.i18n.no_prepaid_card)):t.when(n.processPaymentMethod(e)).then((function(t){"success"===t.result?n.completePayment(e,t.redirect):n.abortPayment(e,t.messages)}))}))},getSelectedProductData:function(){var e=t(".single_add_to_cart_button").val();t(".single_variation_wrap").length&&(e=t(".single_variation_wrap").find('input[name="product_id"]').val());var a=(t("#product-addons-total").data("price_data")||[]).reduce((function(t,e){return t+e.cost}),0),s={security:wcpayPaymentRequestParams.nonce.get_selected_product_data,product_id:e,qty:t(".quantity .qty").val(),attributes:t(".variations_form").length?n.getAttributes().data:[],addon_value:a};return t.ajax({type:"POST",data:s,url:n.getAjaxURL("get_selected_product_data")})},debounce:function(t,e,a){var n;return function(){var s=this,o=arguments,i=function(){n=null,a||e.apply(s,o)},r=a&&!n;clearTimeout(n),n=setTimeout(i,t),r&&e.apply(s,o)}},createPaymentRequestButton:function(e,a){var s;if(wcpayPaymentRequestParams.button.is_custom&&(s=t(wcpayPaymentRequestParams.button.css_selector)).length)return s.data("isCustom",!0),s;if(wcpayPaymentRequestParams.button.is_branded){if(n.shouldUseGooglePayBrand())return(s=n.createGooglePayButton()).data("isBranded",!0),s;wcpayPaymentRequestParams.button.type="long"===wcpayPaymentRequestParams.button.branded_type?"buy":"default"}return e.create("paymentRequestButton",{paymentRequest:a,style:{paymentRequestButton:{type:wcpayPaymentRequestParams.button.type,theme:wcpayPaymentRequestParams.button.theme,height:wcpayPaymentRequestParams.button.height+"px"}}})},isCustomPaymentRequestButton:function(t){return t&&"function"==typeof t.data&&t.data("isCustom")},isBrandedPaymentRequestButton:function(t){return t&&"function"==typeof t.data&&t.data("isBranded")},shouldUseGooglePayBrand:function(){var t=window.navigator.userAgent.toLowerCase(),e=/chrome/.test(t)&&!/edge|edg|opr|brave\//.test(t)&&"Google Inc."===window.navigator.vendor,a=e&&window.navigator.brave;return e&&!a},createGooglePayButton:function(){var e=wcpayPaymentRequestParams.button.theme,a=wcpayPaymentRequestParams.button.branded_type,n=wcpayPaymentRequestParams.button.locale,s=wcpayPaymentRequestParams.button.height;e=["dark","light"].includes(e)?e:"light",a=["short","long"].includes(a)?a:"long";var o=t('<button type="button" id="wcpay-branded-button" aria-label="Google Pay" class="gpay-button"></button>');return o.css("height",s+"px"),o.addClass(e+" "+a),"long"===a&&function(t,e,a){t.css("background-image","url("+e+")");var n=document.createElement("img");n.onerror=function(){t.css("background-image","url("+a+")")},n.src=e}(o,"https://www.gstatic.com/instantbuy/svg/"+e+"/"+n+".svg","https://www.gstatic.com/instantbuy/svg/"+e+"/en.svg"),o},attachPaymentRequestButtonEventListeners:function(t,e){wcpayPaymentRequestParams.is_product_page?n.attachProductPageEventListeners(t,e):n.attachCartPageEventListeners(t,e)},attachProductPageEventListeners:function(e,a){var s=[],o=t(".single_add_to_cart_button");e.on("click",(function(t){return o.is(".disabled")?(t.preventDefault(),void(o.is(".wc-variation-is-unavailable")?window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text):o.is(".wc-variation-selection-needed")&&window.alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text))):0<s.length?(t.preventDefault(),void window.alert(s)):(n.addToCart(),void((n.isCustomPaymentRequestButton(e)||n.isBrandedPaymentRequestButton(e))&&(t.preventDefault(),a.show())))})),t(document.body).on("woocommerce_variation_has_changed",(function(){n.blockPaymentRequestButton(e),t.when(n.getSelectedProductData()).then((function(s){t.when(a.update({total:s.total,displayItems:s.displayItems})).then((function(){n.unblockPaymentRequestButton(e)}))}))})),t(".quantity").on("input",".qty",(function(){n.blockPaymentRequestButton(e)})),t(".quantity").on("input",".qty",n.debounce(250,(function(){n.blockPaymentRequestButton(e),s=[],t.when(n.getSelectedProductData()).then((function(o){o.error?(s=[o.error],n.unblockPaymentRequestButton(e)):t.when(a.update({total:o.total,displayItems:o.displayItems})).then((function(){n.unblockPaymentRequestButton(e)}))}))})))},attachCartPageEventListeners:function(t,e){(wcpayPaymentRequestParams.button.is_custom&&n.isCustomPaymentRequestButton(t)||wcpayPaymentRequestParams.button.is_branded&&n.isBrandedPaymentRequestButton(t))&&t.on("click",(function(t){t.preventDefault(),e.show()}))},showPaymentRequestButton:function(e){n.isCustomPaymentRequestButton(e)?(e.addClass("is-active"),t("#wcpay-payment-request-wrapper, #wcpay-payment-request-button-separator").show()):n.isBrandedPaymentRequestButton(e)?(t("#wcpay-payment-request-wrapper, #wcpay-payment-request-button-separator").show(),t("#wcpay-payment-request-button").html(e)):t("#wcpay-payment-request-button").length&&(t("#wcpay-payment-request-wrapper, #wcpay-payment-request-button-separator").show(),e.mount("#wcpay-payment-request-button"))},blockPaymentRequestButton:function(e){t("#wcpay-payment-request-button").data("blockUI.isBlocked")||(t("#wcpay-payment-request-button").block({message:null}),n.isCustomPaymentRequestButton(e)&&e.addClass("is-blocked"))},unblockPaymentRequestButton:function(e){t("#wcpay-payment-request-button").unblock(),n.isCustomPaymentRequestButton(e)&&e.removeClass("is-blocked")},init:function(){wcpayPaymentRequestParams.is_product_page?n.startPaymentRequest(""):n.getCartDetails()}};n.init(),t(document.body).on("updated_cart_totals",(function(){n.init()})),t(document.body).on("updated_checkout",(function(){n.init()}))}))}();